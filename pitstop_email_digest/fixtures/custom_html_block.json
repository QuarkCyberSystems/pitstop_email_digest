[
 {
  "creation": "2025-07-09 15:31:45.614576",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<table id=\"vehicle_movement_table_ytd_mtd_daily\" style=\"width:100%; border-collapse:collapse; margin:30px 0;\">\n  <thead>\n      <tr>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Time Span</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Cars In</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Cars Out</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Average Time To Deliver(Days)</td>\n      </tr>\n  </thead>\n  <tbody id=\"vehicle_movement_tbody\">\n  </tbody>\n</table>",
  "modified": "2025-08-12 13:52:29.230227",
  "name": "Vehicle Movement Daily Monthly Yearly",
  "private": 0,
  "roles": [],
  "script": "let some_class_element = root_element.querySelector('#vehicle_movement_table_ytd_mtd_daily');\n\nif (some_class_element) {\n\tsome_class_element.style.display = 'none';\n}\n\nvar timespan_obj = {\"daily\":{}, \"monthly\":{}, \"yearly\":{}};\nvar today_date = new Date();\nvar monthname = today_date.toLocaleString('default', { month: 'long' });\nvar yearname = today_date.getFullYear();\nfrappe.call({\n\t\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.get_vehicle_movement\",\n\t\targs: {\n\t\t    customer_list:[\"C00883\", \"C00276\", \"C01053\"]\n\t\t},\n\t\tfreeze: 1,\n\t\tfreeze_message: __(\"Fetching..\"),\n\t\tcallback: (res) => {\n\t\t\tif(res.message) {\n\t\t\t    let tbody_ele = root_element.querySelector('#vehicle_movement_tbody');\n                // Clear any existing content (optional)\n                tbody_ele.innerHTML = \"\";\n\t\t\t    if(res.message.Daily) {\n\t\t\t        timespan_obj[\"daily\"][\"cars_in\"] = res.message.Daily.number_of_vehicle_in[0][\"total_number_cars_in\"]\n\t\t\t        timespan_obj[\"daily\"][\"cars_out\"] = res.message.Daily.number_of_vehicle_out[0][\"total_number_cars_out\"];\n\t\t\t        timespan_obj[\"daily\"][\"average\"] = res.message.Daily.average_time_delivery[0][\"average\"];\n                    \n                    // Create new row for Daily\n                    let dailyRow = document.createElement(\"tr\");\n    \n                    let labelTd = document.createElement(\"td\");\n                    labelTd.textContent = \"Today \"+\"(\"+moment(frappe.datetime.get_today()).format(\"DD-MM-YYYY\")+\")\";\n                    labelTd.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                    dailyRow.appendChild(labelTd);\n    \n                    for (const key in timespan_obj.daily) {\n                        let td = document.createElement(\"td\");\n                        td.textContent = timespan_obj.daily[key];\n                        td.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                        dailyRow.appendChild(td);\n                    }\n    \n                    tbody_ele.appendChild(dailyRow);\n\t\t\t    }\n\t\t\t    if(res.message.Monthly) {\n\t\t\t        timespan_obj[\"monthly\"][\"cars_in\"] = res.message.Monthly.number_of_vehicle_in[0][\"total_number_cars_in\"]\n\t\t\t        timespan_obj[\"monthly\"][\"cars_out\"] = res.message.Monthly.number_of_vehicle_out[0][\"total_number_cars_out\"]\n\t\t\t        timespan_obj[\"monthly\"][\"average\"] = res.message.Monthly.average_time_delivery[0][\"average\"];\n                    \n                    // Create new row for Monthly\n                    let monthlyRow = document.createElement(\"tr\");\n    \n                    let labelTd = document.createElement(\"td\");\n                    labelTd.textContent = \"MTD \"+\"(\"+monthname+\")\";\n                    labelTd.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                    monthlyRow.appendChild(labelTd);\n    \n                    for (const key in timespan_obj.monthly) {\n                        let td = document.createElement(\"td\");\n                        td.textContent = timespan_obj.monthly[key];\n                        td.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                        monthlyRow.appendChild(td);\n                    }\n                    tbody_ele.appendChild(monthlyRow);\n\t\t\t    }\n\t\t\t    if(res.message.Yearly) {\n\t\t\t        timespan_obj[\"yearly\"][\"cars_in\"] = res.message.Yearly.number_of_vehicle_in[0][\"total_number_cars_in\"]\n\t\t\t        timespan_obj[\"yearly\"][\"cars_out\"] = res.message.Yearly.number_of_vehicle_out[0][\"total_number_cars_out\"]\n\t\t\t        timespan_obj[\"yearly\"][\"average\"] = res.message.Yearly.average_time_delivery[0][\"average\"];\n                    \n                    // Create new row for Monthly\n                    let yearlyRow = document.createElement(\"tr\");\n    \n                    let labelTd = document.createElement(\"td\");\n                    labelTd.textContent = \"YTD \"+\"(\"+yearname+\")\";\n                    labelTd.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                    yearlyRow.appendChild(labelTd);\n    \n                    for (const key in timespan_obj.yearly) {\n                        let td = document.createElement(\"td\");\n                        td.textContent = timespan_obj.yearly[key];\n                        td.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                        yearlyRow.appendChild(td);\n                    }\n                    tbody_ele.appendChild(yearlyRow);\n                    some_class_element.style.display = 'table';\n\t\t\t    }\n\t\t\t}\n\t\t}\n\t});",
  "style": null
 },
 {
  "creation": "2025-07-10 19:49:20.533450",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<style>\n    .td_class {\n        border:1px solid #d1d8dd,\n        padding:6px 8px,\n    }\n    .custom-form-group {\n    \tmargin-bottom: 0.6rem;\n    \n    \t&.frappe-control:last-child {\n    \t\tmargin-bottom: 0;\n    \t}\n    \t&:last-child.frappe-control[data-fieldtype=\"Table\"] {\n    \t\tmargin-bottom: 0;\n    \t}\n    \t&.frappe-control[data-fieldtype=\"Check\"] {\n    \t\tmargin-bottom: 0;\n    \t}\n    }\n</style>\n\n<!-- Main bordered container -->\n<div style=\"border: 1px solid #d1d8dd; padding: 16px; border-radius: 6px; background-color: #fff;\">\n\n  <!-- Filter Row -->\n<div id=\"branch_filter_brac\" style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px;\">\n  \n  <div class=\"form-group\" style=\"margin: 0;\">\n    <div class=\"control-input-wrapper\" style=\"width: auto;\">\n      <div class=\"control-input\" style=\"width: auto;\">\n        <div class=\"location-field\"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Apply Filter Button -->\n  <div style=\"margin-bottom: -1%;\">\n    <button type=\"button\" class=\"btn btn-primary apply-filter-btn\">Apply Filter</button>\n  </div>\n\n</div>\n\n<table id=\"vehicle_movement_table\" style=\"width:100%; border-collapse:collapse; margin:30px 0;\">\n  <thead id=\"vehicle_movement_table_header\">\n      <tr>\n        <td  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Status</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Mechanical</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Bodyshop - Cash</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Bodyshop - Insurance</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Total BRAC</td>\n      </tr>\n      <tr>\n          <td rowspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">RO Status</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n      </tr>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n      </tr>\n  </thead>\n  <tbody id=\"vehicle_movement_tbody_division\">\n  </tbody>\n</table>\n</div>\n",
  "modified": "2025-08-20 16:13:39.137648",
  "name": "Vehicle Movement Workshop Division BRAC",
  "private": 0,
  "roles": [],
  "script": "\n\n// 1. Get wrapper for date field\nlet location_wrapper = root_element.querySelector(\".location-field\");\n\nvar location_control = frappe.ui.form.make_control({\n      df: {\n        fieldtype: \"Select\",\n        fieldname: \"posting_date\",\n        label: \"Branch\",\n        reqd: 0,\n      },\n      parent: location_wrapper,\n      render_input: true\n});\n\nfrappe.call({\n\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.fetch_branch\",\n\tfreeze: 1,\n    freeze_message: __(\"Fetching..\"),\n\tcallback: (branch_res) => {\n\t    let yzed = [\"\"].concat(branch_res.message);\n\t   // y.concat(branch_res.message);\n\t   // console.log(y)\n        location_control.df.options = yzed;\n        // 4. Render the field with today's value\n        location_control.refresh();\n\t}\n});\n\nlet some_class_element = root_element.querySelector('#vehicle_movement_table');\n\nif (some_class_element) {\n\tsome_class_element.style.display = 'none';\n}\n\nwindow.drill_down_ytd = function(ro_status, workshop_division, bill_type, customer_type, timespan) {\n\t\t\n\t\tfrappe.route_options = {\n\t\t\tfrom_date: frappe.defaults.get_user_default(\"year_start_date\"),\n\t\t\tto_date: frappe.datetime.get_today(),\n\t\t\tworkshop_division: workshop_division,\n\t\t\tproject_status: ro_status\n\t\t};\n\t\t\n\t\tif(timespan == \"YTD\") {\n\t\t    frappe.route_options[\"from_date\"] = frappe.defaults.get_user_default(\"year_start_date\");\n\t\t}\n\t\telse if(timespan == \"MTD\") {\n\t\t    frappe.route_options[\"from_date\"] = frappe.datetime.month_start();\n\t\t}\n\t\t\n\t\tif (bill_type) {\n\t\t\tfrappe.route_options[\"billing_type\"] = bill_type;\n\t\t}\n\t\t\n        frappe.set_route(\"query-report\", \"Related Parties I_O\");\n\t};\n\nfunction fetch_brac_data() {\n    const division_dict = [\n    \t\t{\"workshop_division\": \"Mechanical\", \"bill_to_customer_check\": null, \"customer_list\":[\"C00883\", \"C00276\", \"C01053\"], \"category\": \"Mechanical\"},\n    \t\t{\"workshop_division\": null, \"bill_to_customer_check\": null, \"customer_list\":[\"C00883\", \"C00276\", \"C01053\"], \"category\": \"BRAC\"},\n    \t\t{\"workshop_division\": \"Body Shop\", \"bill_to_customer_check\": \"Same\", \"customer_list\":[\"C00883\", \"C00276\", \"C01053\"], \"category\": \"Body Shop - Cash\"},\n    \t\t{\"workshop_division\": \"Body Shop\", \"bill_to_customer_check\": \"Insurance\", \"customer_list\":[\"C00883\", \"C00276\", \"C01053\"],  \"category\": \"Body Shop - Insurance\"},\n    \t]\n    \n    frappe.call({\n    \t\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.fetch_ro_project_status_based_workshop_division_for_vehicle\",\n    \t\targs: {\n    \t\t  division_dict: division_dict,\n    \t\t  timespan: \"MTD and YTD\",\n    \t\t  branch: location_control.get_value()\n    \t\t},\n    \t\tfreeze: 1,\n    \t\tfreeze_message: __(\"Fetching..\"),\n    \t\tcallback: (res) => {\n    \t\t    var custom_order = [\n            \t\t\"To Estimate\",\n            \t\t\"Awaiting Approval\",\n            \t\t\"Awaiting Claim No\",\n            \t\t\"To Assign\",\n            \t\t\"Assigned\",\n            \t\t\"In Progress\",\n            \t\t\"Awaiting Parts\",\n            \t\t\"Parts Arrived\",\n            \t\t\"Tasks Completed\",\n            \t\t\"Awaiting LPO\",\n            \t\t\"Awaiting Gate Pass\",\n            \t\t\"Ready for Collection\",\n            \t\t\"Not Invoiced\",\n            \t\t\"Total Loss\"\n            \t] \n    \t\t\tif(res.message) {\n    \t\t\t    let tbody_ele = root_element.querySelector('#vehicle_movement_tbody_division');\n    \t\t\t    tbody_ele.innerHTML = \"\";\n    \t\t\t    let tr_message = \"\";\n    \t\t\t    let ytd_count = 0;\n    \t\t\t    \n        \t\t\t    \n        \t\t\tvar count_found_mechanical_mtd = 0, count_found_mechanical_ytd = 0, count_found_mechanical_mtd_avg = 0, count_found_mechanical_ytd_avg = 0, count_found_brac_mtd = 0, count_found_brac_avg_mtd = 0, count_found_brac_avg_ytd = 0, count_found_brac_ytd = 0, \n        \t\t\t    count_found_bs_cash_mtd_avg = 0, count_found_bs_cash_ytd_avg = 0, count_found_bs_cash_mtd = 0, count_found_bs_cash_ytd = 0, count_found_bs_insurance_mtd = 0, count_found_bs_insurance_ytd = 0, count_found_bs_insurance_avg_mtd = 0, count_found_bs_insurance_avg_ytd = 0\n        \t\t\t    total_time_take_mechanical_mtd = 0, total_time_take_mechanical_ytd = 0, total_time_take_brac_mtd = 0, total_time_take_brac_ytd = 0, total_time_take_bs_cash_mtd = 0, total_time_take_bs_cash_ytd = 0, total_time_take_bs_insurance_mtd = 0, total_time_take_bs_insurance_ytd = 0;\n    \t\t\t    \n    \t\t\t    for(let each_project_defined_status of custom_order) {\n        \t\t\t    let found_mechanical_mtd = false, found_mechanical_ytd = false, found_brac_mtd = false, found_brac_ytd = false, \n        \t\t\t    found_bs_cash_mtd = false, found_bs_cash_ytd = false, found_bs_insurance_mtd = false, found_bs_insurance_ytd = false;\n        \t\t\t    \n        \t\t\t    tr_message += \"<tr><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_project_defined_status+\"</td>\";\n        \t\t\t    for(let each_dict_mechanical of res.message.mechanical_category) {\n        \t\t\t        if((each_dict_mechanical.project_status == each_project_defined_status) && (each_dict_mechanical.MTD)){\n        \t\t\t            found_mechanical_mtd = true;\n        \t\t\t            count_found_mechanical_mtd += each_dict_mechanical.total_ro;\n        \t\t\t            count_found_mechanical_mtd_avg += each_dict_mechanical.average;\n        \t\t\t            total_time_take_mechanical_mtd += each_dict_mechanical.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_mechanical.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_mechanical.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_mechanical_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_mechanical of res.message.mechanical_category) {\n        \t\t\t        if((each_dict_mechanical.project_status == each_project_defined_status) && (each_dict_mechanical.YTD)){\n        \t\t\t            found_mechanical_ytd = true;\n        \t\t\t            count_found_mechanical_ytd += each_dict_mechanical.total_ro;\n        \t\t\t            count_found_mechanical_ytd_avg += each_dict_mechanical.average;\n        \t\t\t            total_time_take_mechanical_ytd += each_dict_mechanical.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_mechanical.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_mechanical.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_mechanical_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_bs_cash of res.message.body_shop_cash_category) {\n        \t\t\t        if((each_dict_bs_cash.project_status == each_project_defined_status) && (each_dict_bs_cash.MTD)){\n        \t\t\t            found_bs_cash_mtd = true;\n        \t\t\t            count_found_bs_cash_mtd += each_dict_bs_cash.total_ro;\n        \t\t\t            count_found_bs_cash_mtd_avg += each_dict_bs_cash.average;\n        \t\t\t            total_time_take_bs_cash_mtd += each_dict_bs_cash.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_cash.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_cash.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_cash_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_bs_cash of res.message.body_shop_cash_category) {\n        \t\t\t        if((each_dict_bs_cash.project_status == each_project_defined_status) && (each_dict_bs_cash.YTD)){\n        \t\t\t            found_bs_cash_ytd = true;\n        \t\t\t            count_found_bs_cash_ytd += each_dict_bs_cash.total_ro;\n        \t\t\t            count_found_bs_cash_ytd_avg += each_dict_bs_cash.average;\n        \t\t\t            total_time_take_bs_cash_ytd += each_dict_bs_cash.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_cash.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_cash.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_cash_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    for(let each_dict_bs_insurance of res.message.body_shop_insurance_category) {\n        \t\t\t        if((each_dict_bs_insurance.project_status == each_project_defined_status) && (each_dict_bs_insurance.MTD)){\n        \t\t\t            found_bs_insurance_mtd = true;\n        \t\t\t            count_found_bs_insurance_mtd += each_dict_bs_insurance.total_ro;\n        \t\t\t            count_found_bs_insurance_avg_mtd += each_dict_bs_insurance.average;\n        \t\t\t            total_time_take_bs_insurance_mtd += each_dict_bs_insurance.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_insurance.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_insurance.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_insurance_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null,  `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_bs_insurance of res.message.body_shop_insurance_category) {\n        \t\t\t        if((each_dict_bs_insurance.project_status == each_project_defined_status) && (each_dict_bs_insurance.YTD)){\n        \t\t\t            found_bs_insurance_ytd = true;\n        \t\t\t            count_found_bs_insurance_ytd += each_dict_bs_insurance.total_ro;\n        \t\t\t            count_found_bs_insurance_avg_ytd += each_dict_bs_insurance.average;\n        \t\t\t            total_time_take_bs_insurance_ytd += each_dict_bs_insurance.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_insurance.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_insurance.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_insurance_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    for(let each_dict_brac of res.message.brac_category) {\n        \t\t\t        if((each_dict_brac.project_status == each_project_defined_status) && (each_dict_brac.MTD)){\n        \t\t\t            found_brac_mtd = true;\n        \t\t\t            count_found_brac_mtd += each_dict_brac.total_ro;\n        \t\t\t            count_found_brac_avg_mtd += each_dict_brac.average;\n        \t\t\t            total_time_take_brac_mtd += each_dict_brac.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_brac.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_brac_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `MTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_brac of res.message.brac_category) {\n        \t\t\t        if((each_dict_brac.project_status == each_project_defined_status) && (each_dict_brac.YTD)){\n        \t\t\t            found_brac_ytd = true;\n        \t\t\t            count_found_brac_ytd += each_dict_brac.total_ro;\n        \t\t\t            count_found_brac_avg_ytd += each_dict_brac.average;\n        \t\t\t            total_time_take_brac_ytd += each_dict_brac.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_brac.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_brac_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `YTD`)' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    tr_message += \"</tr>\"\n        \t\t\t    \n    \t\t\t    }\n    \t\t\t    \n    \t\t\t    tr_message += \"<tr style='background-color:#f8f8f8;'><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>Total</b></td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_mechanical_mtd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_mechanical_mtd>0 ?Math.floor(total_time_take_mechanical_mtd / count_found_mechanical_mtd):0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_mechanical_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_mechanical_ytd>0?Math.floor(total_time_take_mechanical_ytd / count_found_mechanical_ytd) : 0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_cash_mtd+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_cash_mtd > 0 ? Math.floor(total_time_take_bs_cash_mtd / count_found_bs_cash_mtd) : 0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_cash_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_cash_ytd>0?Math.floor(total_time_take_bs_cash_ytd / count_found_bs_cash_ytd) : 0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_insurance_mtd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_insurance_mtd?Math.floor(total_time_take_bs_insurance_mtd / count_found_bs_insurance_mtd):0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_insurance_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_insurance_ytd>0?Math.floor(total_time_take_bs_insurance_ytd / count_found_bs_insurance_ytd):0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_brac_mtd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_brac_mtd>0?Math.floor(total_time_take_brac_mtd / count_found_brac_mtd):0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_brac_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_brac_ytd>0?Math.floor(total_time_take_brac_ytd / count_found_brac_ytd):0)+\"</td>\";\n    \t\t\t    tbody_ele.innerHTML = tr_message;\n    \t\t\t    some_class_element.style.display = 'block';\n                }\n        }\n    });\n}\n\nfetch_brac_data();\n\n// 7. Add listener to Apply Filter button\nlet apply_btn = root_element.querySelector(\".apply-filter-btn\");\n\napply_btn.addEventListener(\"click\", () => {\n  fetch_brac_data();\n});\n",
  "style": null
 },
 {
  "creation": "2025-07-29 09:54:12.641838",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Main bordered container -->\n<div style=\"border: 1px solid #d1d8dd; padding: 16px; border-radius: 6px; background-color: #fff;\">\n\n  <!-- Filter Row -->\n<div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px;\">\n\n  <!-- Posting Date Field -->\n  <div class=\"form-group\" style=\"margin: 0;\">\n    <div class=\"control-input-wrapper\" style=\"width: auto;\">\n      <div class=\"control-input\" style=\"width: auto;\">\n        <div class=\"posting-date-field\"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Apply Filter Button -->\n  <div style=\"margin-bottom: -1%;\">\n    <button type=\"button\" class=\"btn btn-primary apply-filter-btn\">Apply Filter</button>\n  </div>\n\n</div>\n\n  <!-- Table -->\n  <table id=\"vehicle_movement_table_brac_a_day\" style=\"width:100%; border-collapse:collapse;\">\n    <thead id=\"vehicle_movement_table_header\">\n      <tr>\n        <td rowspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Status</td>\n        <td colspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Number Of Cars</td>\n      </tr>\n      <tr>\n        <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Bodyshop</td>\n        <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Mechanical</td>\n        <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Total</td>\n      </tr>\n    </thead>\n    <tbody id=\"vehicle_movement_tbody_division_brac_a_day\">\n    </tbody>\n  </table>\n\n</div>\n",
  "modified": "2025-08-13 18:09:55.174975",
  "name": "Vehicle Movement a Day BRAC",
  "private": 0,
  "roles": [],
  "script": "// 1. Get wrapper for date field\nlet posting_date_wrapper = root_element.querySelector(\".posting-date-field\");\n\n// 2. Get today's date in YYYY-MM-DD\nlet today = frappe.datetime.get_today();\n\n// 3. Create the native Frappe date field\nlet posting_date_control = frappe.ui.form.make_control({\n  df: {\n    fieldtype: \"Date\",\n    fieldname: \"posting_date\",\n    label: \"Job Date\",\n    reqd: 1,\n    default: today\n  },\n  parent: posting_date_wrapper,\n  render_input: true\n});\n\n// 4. Render the field with today's value\nposting_date_control.refresh();\nposting_date_control.set_value(today);\n\n// 5. Define your data-fetching function\nfunction fetchVehicleMovementData(selected_date) {\n  const division_dict = [\n    {\n      \"workshop_division\": \"Body Shop\",\n      \"bill_to_customer_check\": null,\n      \"customer_list\": [\"C00883\", \"C00276\", \"C01053\"],\n      \"category\": \"BRAC BODYSHOP\"\n    },\n    {\n      \"workshop_division\": \"Mechanical\",\n      \"bill_to_customer_check\": null,\n      \"customer_list\": [\"C00883\", \"C00276\", \"C01053\"],\n      \"category\": \"BRAC MECHANICAL\"\n    },\n  ];\n\n  frappe.call({\n    method: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.fetch_ro_project_status_based_workshop_division_for_vehicle\",\n    args: {\n      division_dict: division_dict,\n      timespan: \"Custom Date\",\n      selected_date: selected_date\n    },\n    freeze: 1,\n    freeze_message: __(\"Fetching..\"),\n    callback: (res) => {\n      var custom_order = [\n        \t\t\"To Estimate\",\n        \t\t\"Awaiting Approval\",\n        \t\t\"Awaiting Claim No\",\n        \t\t\"To Assign\",\n        \t\t\"Assigned\",\n        \t\t\"In Progress\",\n        \t\t\"Awaiting Parts\",\n        \t\t\"Parts Arrived\",\n        \t\t\"Tasks Completed\",\n        \t\t\"Awaiting LPO\",\n        \t\t\"Awaiting Gate Pass\",\n        \t\t\"Ready for Collection\",\n        \t\t\"Not Invoiced\",\n        \t\t\"Total Loss\",\n        \t\t\"Completed\"\n        \t];\n      let tbody_ele = root_element.querySelector('#vehicle_movement_tbody_division_brac_a_day');\n      tbody_ele.innerHTML = \"\";\n      let tr_message = \"\";\n      let mechanical_total_count = 0;\n      let bodyshop_total_count = 0;\n      let brac_total_count = 0;\n      if (res.message) {\n          for(let each_project_defined_status of custom_order) {\n            let status_count_mechanical = 0;\n            let status_count_bodyshop = 0;\n            let found_mechanical = false;\n            let found_bodyshop = false;\n            let status_data_tr = \"\";\n            status_data_tr = \"<tr><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_project_defined_status+\"</td>\";\n            for(let each_dict_brac_mechanical of res.message.brac_mechanical) {\n\t\t        if(each_dict_brac_mechanical.project_status == each_project_defined_status){\n\t\t            found_mechanical = true;\n\t\t            status_count_mechanical += each_dict_brac_mechanical.total_ro;\n\t\t            status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac_mechanical.total_ro+\"</td>\";\n\t\t        }\n\t\t    }\n\t\t    if(!found_mechanical){\n\t\t           status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n\t\t    }\n\t\t    for(let each_dict_brac_bodyshop of res.message.brac_bodyshop) {\n\t\t        if(each_dict_brac_bodyshop.project_status == each_project_defined_status){\n\t\t            found_bodyshop = true;\n\t\t            status_count_bodyshop += each_dict_brac_bodyshop.total_ro;\n\t\t            status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac_bodyshop.total_ro+\"</td>\";\n\t\t        }\n\t\t    }\n\t\t    \n\t\t    if(!found_bodyshop){\n\t\t           status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n\t\t    }\n\t\t    \n\t\t    if(found_mechanical || found_bodyshop) {\n\t\t        tr_message += status_data_tr;\n\t\t        mechanical_total_count += status_count_mechanical;\n\t\t        bodyshop_total_count += status_count_bodyshop;\n\t\t        let sum_bodyshop_mechanical = status_count_mechanical+status_count_bodyshop;\n\t\t        tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+sum_bodyshop_mechanical+\"</td></tr>\";\n\t\t    }\n          }\n        if(!tr_message) {\n            tr_message += `\n                <tr>\n                    <td colspan=\"4\" style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>No Data</td>\n                </tr>\n            `;\n        }\n        else {\n            tr_message += `<tr style='background: #f8f8f8;'>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>Total</b></td>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>${mechanical_total_count}</b></td>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>${bodyshop_total_count}</b></td>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>${mechanical_total_count+bodyshop_total_count}</b></td>\n                </tr>`;\n        }\n        tbody_ele.innerHTML = tr_message;\n      }\n    }\n  });\n}\n\n// 6. Trigger fetch immediately on load with today\nfetchVehicleMovementData(today);\n\n// 7. Add listener to Apply Filter button\nlet apply_btn = root_element.querySelector(\".apply-filter-btn\");\n\napply_btn.addEventListener(\"click\", () => {\n  let selected_date = posting_date_control.get_value();\n\n  if (!selected_date) {\n    frappe.msgprint(\"Please select a date.\");\n    return;\n  }\n\n  fetchVehicleMovementData(selected_date);\n});\n",
  "style": null
 }
]