[
 {
  "creation": "2025-07-09 15:31:45.614576",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<table id=\"vehicle_movement_table_ytd_mtd_daily\" style=\"width:100%; border-collapse:collapse; margin:30px 0;\">\n  <thead>\n      <tr>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Time Span</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Cars In</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Cars Out</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;\">Average Time To Deliver(Days)</td>\n      </tr>\n  </thead>\n  <tbody id=\"vehicle_movement_tbody\">\n  </tbody>\n</table>",
  "modified": "2025-08-21 21:56:15.505013",
  "name": "Vehicle Movement Daily Monthly Yearly",
  "private": 0,
  "roles": [],
  "script": "let some_class_element = root_element.querySelector('#vehicle_movement_table_ytd_mtd_daily');\n\nif (some_class_element) {\n\tsome_class_element.style.display = 'none';\n}\n\nvar timespan_obj = {\"daily\":{}, \"monthly\":{}, \"yearly\":{}};\nvar today_date = new Date();\nvar monthname = today_date.toLocaleString('default', { month: 'long' });\nvar yearname = today_date.getFullYear();\nfrappe.call({\n\t\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.get_vehicle_movement\",\n\t\targs: {\n\t\t    workspace:\"Brac\"\n\t\t},\n\t\tfreeze: 1,\n\t\tfreeze_message: __(\"Fetching..\"),\n\t\tcallback: (res) => {\n\t\t\tif(res.message) {\n\t\t\t    let tbody_ele = root_element.querySelector('#vehicle_movement_tbody');\n                // Clear any existing content (optional)\n                tbody_ele.innerHTML = \"\";\n\t\t\t    if(res.message.Daily) {\n\t\t\t        timespan_obj[\"daily\"][\"cars_in\"] = res.message.Daily.number_of_vehicle_in[0][\"total_number_cars_in\"]\n\t\t\t        timespan_obj[\"daily\"][\"cars_out\"] = res.message.Daily.number_of_vehicle_out[0][\"total_number_cars_out\"];\n\t\t\t        timespan_obj[\"daily\"][\"average\"] = res.message.Daily.average_time_delivery[0][\"average\"];\n                    \n                    // Create new row for Daily\n                    let dailyRow = document.createElement(\"tr\");\n    \n                    let labelTd = document.createElement(\"td\");\n                    labelTd.textContent = \"Today \"+\"(\"+moment(frappe.datetime.get_today()).format(\"DD-MM-YYYY\")+\")\";\n                    labelTd.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                    dailyRow.appendChild(labelTd);\n    \n                    for (const key in timespan_obj.daily) {\n                        let td = document.createElement(\"td\");\n                        td.textContent = timespan_obj.daily[key];\n                        td.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                        dailyRow.appendChild(td);\n                    }\n    \n                    tbody_ele.appendChild(dailyRow);\n\t\t\t    }\n\t\t\t    if(res.message.Monthly) {\n\t\t\t        timespan_obj[\"monthly\"][\"cars_in\"] = res.message.Monthly.number_of_vehicle_in[0][\"total_number_cars_in\"]\n\t\t\t        timespan_obj[\"monthly\"][\"cars_out\"] = res.message.Monthly.number_of_vehicle_out[0][\"total_number_cars_out\"]\n\t\t\t        timespan_obj[\"monthly\"][\"average\"] = res.message.Monthly.average_time_delivery[0][\"average\"];\n                    \n                    // Create new row for Monthly\n                    let monthlyRow = document.createElement(\"tr\");\n    \n                    let labelTd = document.createElement(\"td\");\n                    labelTd.textContent = \"MTD \"+\"(\"+monthname+\")\";\n                    labelTd.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                    monthlyRow.appendChild(labelTd);\n    \n                    for (const key in timespan_obj.monthly) {\n                        let td = document.createElement(\"td\");\n                        td.textContent = timespan_obj.monthly[key];\n                        td.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                        monthlyRow.appendChild(td);\n                    }\n                    tbody_ele.appendChild(monthlyRow);\n\t\t\t    }\n\t\t\t    if(res.message.Yearly) {\n\t\t\t        timespan_obj[\"yearly\"][\"cars_in\"] = res.message.Yearly.number_of_vehicle_in[0][\"total_number_cars_in\"]\n\t\t\t        timespan_obj[\"yearly\"][\"cars_out\"] = res.message.Yearly.number_of_vehicle_out[0][\"total_number_cars_out\"]\n\t\t\t        timespan_obj[\"yearly\"][\"average\"] = res.message.Yearly.average_time_delivery[0][\"average\"];\n                    \n                    // Create new row for Monthly\n                    let yearlyRow = document.createElement(\"tr\");\n    \n                    let labelTd = document.createElement(\"td\");\n                    labelTd.textContent = \"YTD \"+\"(\"+yearname+\")\";\n                    labelTd.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                    yearlyRow.appendChild(labelTd);\n    \n                    for (const key in timespan_obj.yearly) {\n                        let td = document.createElement(\"td\");\n                        td.textContent = timespan_obj.yearly[key];\n                        td.style = \"border:1px solid #d1d8dd;padding:6px 8px;\";\n                        yearlyRow.appendChild(td);\n                    }\n                    tbody_ele.appendChild(yearlyRow);\n                    some_class_element.style.display = 'table';\n\t\t\t    }\n\t\t\t}\n\t\t}\n\t});",
  "style": null
 },
 {
  "creation": "2025-07-10 19:49:20.533450",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<style>\n    .td_class {\n        border:1px solid #d1d8dd,\n        padding:6px 8px,\n    }\n    .custom-form-group {\n    \tmargin-bottom: 0.6rem;\n    \n    \t&.frappe-control:last-child {\n    \t\tmargin-bottom: 0;\n    \t}\n    \t&:last-child.frappe-control[data-fieldtype=\"Table\"] {\n    \t\tmargin-bottom: 0;\n    \t}\n    \t&.frappe-control[data-fieldtype=\"Check\"] {\n    \t\tmargin-bottom: 0;\n    \t}\n    }\n</style>\n\n<!-- Main bordered container -->\n<div style=\"border: 1px solid #d1d8dd; padding: 16px; border-radius: 6px; background-color: #fff;\">\n\n  <!-- Filter Row -->\n<div id=\"branch_filter_brac\" \n     style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px; position: relative;\">\n\n  <!-- Download Icon (top-right) -->\n  <div style=\"position: absolute; top: 0; right: 0;\">\n    <i id=\"download_button_icon_id\" class=\"fa fa-download\" \n       style=\"cursor: pointer; font-size: 18px; color: #4a5568;\"\n       title=\"Download\"></i>\n  </div>\n\n  <div class=\"form-group\" style=\"margin: 0;\">\n    <div class=\"control-input-wrapper\" style=\"width: auto;\">\n      <div class=\"control-input\" style=\"width: auto;\">\n        <div class=\"location-field\"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Apply Filter Button -->\n  <div style=\"margin-bottom: -1%;\">\n    <button type=\"button\" class=\"btn btn-primary apply-filter-btn\">Apply Filter</button>\n  </div>\n\n</div>\n\n<table id=\"vehicle_movement_table\" style=\"width:100%; border-collapse:collapse; margin:30px 0;\">\n  <thead id=\"vehicle_movement_table_header\">\n      <tr>\n        <td  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Status</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Mech.</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">BS - Cash</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">BS - Insurance</td>\n        <td colspan=\"4\"  style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Total BRAC</td>\n      </tr>\n      <tr>\n          <td rowspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">RO Status</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">MTD</td>\n          <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">YTD</td>\n      </tr>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">No. Of Cars</td>\n          <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Avg. Days</td>\n      </tr>\n  </thead>\n  <tbody id=\"vehicle_movement_tbody_division\">\n  </tbody>\n</table>\n</div>\n",
  "modified": "2025-09-29 12:52:28.645535",
  "name": "Vehicle Movement Workshop Division BRAC",
  "private": 0,
  "roles": [],
  "script": "\n\n\n\n// 1. Get wrapper for date field\nlet location_wrapper = root_element.querySelector(\".location-field\");\n\nvar location_control = frappe.ui.form.make_control({\n      df: {\n        fieldtype: \"Select\",\n        fieldname: \"posting_date\",\n        label: \"Branch\",\n        reqd: 0,\n      },\n      parent: location_wrapper,\n      render_input: true\n});\n\nfrappe.call({\n\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.fetch_branch\",\n\tfreeze: 1,\n\tfreeze_message: __(\"Fetching..\"),\n\tcallback: (res) => {\n\t    let branches_list_options = [];\n\t    if(res.message) {\n\t        branches_list_options = [\"\"].concat(res.message);\n            location_control.df.options = branches_list_options;\n            location_control.refresh();\n\t    }\n\t}\n});\n\nlet some_class_element = root_element.querySelector('#vehicle_movement_table');\n\nif (some_class_element) {\n\tsome_class_element.style.display = 'none';\n}\n\nvar project_task_type = [];\n\nwindow.drill_down_ytd = function(ro_status, workshop_division, bill_type, customer_type, timespan, branch, project_task_type_dict) {\n\t\t\n\t\tlet project_status = ro_status;\n\t\tlet current_task_type = null;\n\t\tfor(let each_ro_task_status of project_task_type) {\n\t\t    if(each_ro_task_status[ro_status]) {\n\t\t        project_status = each_ro_task_status[ro_status];\n\t\t        current_task_type = each_ro_task_status[\"current_task_type\"];\n\t\t        break;\n\t\t    }\n\t\t}\n\t\tfrappe.route_options = {\n\t\t\tfrom_date: frappe.defaults.get_user_default(\"year_start_date\"),\n\t\t\tto_date: frappe.datetime.get_today(),\n\t\t\tworkshop_division: workshop_division,\n\t\t\tproject_status: project_status\n\t\t};\n\t\t\n\t\tif(current_task_type) {\n\t\t    frappe.route_options[\"current_task_type\"] = current_task_type;\n\t\t}\n\t\t\n\t\tif(timespan == \"YTD\") {\n\t\t    frappe.route_options[\"from_date\"] = frappe.defaults.get_user_default(\"year_start_date\");\n\t\t}\n\t\telse if(timespan == \"MTD\") {\n\t\t    frappe.route_options[\"from_date\"] = frappe.datetime.month_start();\n\t\t}\n\t\t\n\t\tif (bill_type) {\n\t\t\tfrappe.route_options[\"billing_type\"] = bill_type;\n\t\t}\n\t\t\n\t\tif (branch) {\n\t\t    frappe.route_options[\"branch\"] = branch;\n\t\t}\n\t\t\n\t\tfrappe.route_options[\"workspace\"] = \"Brac\";\n\t\tfrappe.open_in_new_tab = true;\n        frappe.set_route(\"query-report\", \"Related Parties I_O\");\n\t};\n\nfunction fetch_brac_data(branch) {\n    const division_dict = [\n    \t\t{\"workshop_division\": \"Mechanical\", \"bill_to_customer_check\": null, \"category\": \"Mechanical\"},\n    \t\t{\"workshop_division\": null, \"bill_to_customer_check\": null, \"category\": \"BRAC\"},\n    \t\t{\"workshop_division\": \"Body Shop\", \"bill_to_customer_check\": \"Same\", \"category\": \"Body Shop - Cash\"},\n    \t\t{\"workshop_division\": \"Body Shop\", \"bill_to_customer_check\": \"Insurance\",  \"category\": \"Body Shop - Insurance\"},\n    \t]\n    \n    frappe.call({\n    \t\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.fetch_ro_project_status_based_workshop_division_for_vehicle\",\n    \t\targs: {\n    \t\t  division_dict: division_dict,\n    \t\t  timespan: \"MTD and YTD\",\n    \t\t  branch: branch,\n    \t\t  workspace: \"BRAC\"\n    \t\t},\n    \t\tfreeze: 1,\n    \t\tfreeze_message: __(\"Fetching..\"),\n    \t\tcallback: (res) => {\n    \t\t    var custom_order = [\n            \t\t\"To Estimate\",\n            \t\t\"Awaiting Approval\",\n            \t\t\"Awaiting Claim No\",\n            \t\t\"To Assign\",\n            \t\t\"Awaiting Parts\",\n            \t\t\"Awaiting Parts Estimate\",\n            \t\t\"Parts Arrived\",\n            \t\t\"Tasks Completed\",\n            \t\t\"Awaiting LPO\",\n            \t\t\"Awaiting Gate Pass\",\n            \t\t\"Ready for Collection\",\n            \t\t\"Not Invoiced\",\n            \t\t\"Total Loss\"\n            \t];\n            \t\n            \tfor(let each_key_mech_cat of res.message.mechanical_category) {\n                    if(each_key_mech_cat.current_task_type){\n                        if(!custom_order.includes(each_key_mech_cat.project_status)) {\n                            custom_order.splice(4,0,each_key_mech_cat.project_status);\n                            project_task_type.push({[each_key_mech_cat.project_status]:each_key_mech_cat.original_project_status, \"current_task_type\":each_key_mech_cat.current_task_type});\n                        }\n                    }\n                  }\n                  \n                for(let each_key_bs_cash of res.message.body_shop_cash_category) {\n                    if(each_key_bs_cash.current_task_type){\n                        if(!custom_order.includes(each_key_bs_cash.project_status)) {\n                            custom_order.splice(5,0,each_key_bs_cash.project_status);\n                            project_task_type.push({[each_key_bs_cash.project_status]:each_key_bs_cash.original_project_status, \"current_task_type\":each_key_bs_cash.current_task_type});\n                        }\n                    }\n                  }\n                \n                for(let each_key_bs_insurance of res.message.body_shop_insurance_category) {\n                    if(each_key_bs_insurance.current_task_type){\n                        if(!custom_order.includes(each_key_bs_insurance.project_status)) {\n                            custom_order.splice(6,0,each_key_bs_insurance.project_status);\n                            project_task_type.push({[each_key_bs_insurance.project_status]:each_key_bs_insurance.original_project_status, \"current_task_type\":each_key_bs_insurance.current_task_type});\n                        }\n                    }\n                  } \n                \n            \t\n            \tfor(let each_key_brac of res.message.brac_category) {\n                    if(each_key_brac.current_task_type){\n                        if(!custom_order.includes(each_key_brac.project_status)) {\n                            custom_order.splice(7,0,each_key_brac.project_status);\n                            project_task_type.push({[each_key_brac.project_status]:each_key_brac.original_project_status, \"current_task_type\":each_key_brac.current_task_type});\n                        }\n                    }\n                  }\n            \t\n    \t\t\tif(res.message) {\n    \t\t\t    \n    \t\t\t    let tbody_ele = root_element.querySelector('#vehicle_movement_tbody_division');\n    \t\t\t    tbody_ele.innerHTML = \"\";\n    \t\t\t    let tr_message = \"\";\n    \t\t\t    let ytd_count = 0;\n    \t\t\t    let selected_branch = res.message.selected_filters.branch;\n    \t\t\t    \n        \t\t\t    \n        \t\t\tvar count_found_mechanical_mtd = 0, count_found_mechanical_ytd = 0, count_found_mechanical_mtd_avg = 0, count_found_mechanical_ytd_avg = 0, count_found_brac_mtd = 0, count_found_brac_avg_mtd = 0, count_found_brac_avg_ytd = 0, count_found_brac_ytd = 0, \n        \t\t\t    count_found_bs_cash_mtd_avg = 0, count_found_bs_cash_ytd_avg = 0, count_found_bs_cash_mtd = 0, count_found_bs_cash_ytd = 0, count_found_bs_insurance_mtd = 0, count_found_bs_insurance_ytd = 0, count_found_bs_insurance_avg_mtd = 0, count_found_bs_insurance_avg_ytd = 0\n        \t\t\t    total_time_take_mechanical_mtd = 0, total_time_take_mechanical_ytd = 0, total_time_take_brac_mtd = 0, total_time_take_brac_ytd = 0, total_time_take_bs_cash_mtd = 0, total_time_take_bs_cash_ytd = 0, total_time_take_bs_insurance_mtd = 0, total_time_take_bs_insurance_ytd = 0;\n    \t\t\t    \n    \t\t\t    for(let each_project_defined_status of custom_order) {\n        \t\t\t    let found_mechanical_mtd = false, found_mechanical_ytd = false, found_brac_mtd = false, found_brac_ytd = false, \n        \t\t\t    found_bs_cash_mtd = false, found_bs_cash_ytd = false, found_bs_insurance_mtd = false, found_bs_insurance_ytd = false;\n        \t\t\t    \n        \t\t\t    tr_message += \"<tr><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_project_defined_status+\"</td>\";\n        \t\t\t    for(let each_dict_mechanical of res.message.mechanical_category) {\n        \t\t\t        if((each_dict_mechanical.project_status == each_project_defined_status) && (each_dict_mechanical.MTD)){\n        \t\t\t            found_mechanical_mtd = true;\n        \t\t\t            count_found_mechanical_mtd += each_dict_mechanical.total_ro;\n        \t\t\t            count_found_mechanical_mtd_avg += each_dict_mechanical.average;\n        \t\t\t            total_time_take_mechanical_mtd += each_dict_mechanical.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `MTD`, \\\"\"+selected_branch+\"\\\", \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_mechanical.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_mechanical.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_mechanical_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `MTD`, \\\"\"+selected_branch+\"\\\", \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_mechanical of res.message.mechanical_category) {\n        \t\t\t        if((each_dict_mechanical.project_status == each_project_defined_status) && (each_dict_mechanical.YTD)){\n        \t\t\t            found_mechanical_ytd = true;\n        \t\t\t            count_found_mechanical_ytd += each_dict_mechanical.total_ro;\n        \t\t\t            count_found_mechanical_ytd_avg += each_dict_mechanical.average;\n        \t\t\t            total_time_take_mechanical_ytd += each_dict_mechanical.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `YTD`, \\\"\"+selected_branch+\"\\\", \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_mechanical.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_mechanical.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_mechanical_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Mechanical`, null, null, `YTD`, \\\"\"+selected_branch+\"\\\", \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_bs_cash of res.message.body_shop_cash_category) {\n        \t\t\t        if((each_dict_bs_cash.project_status == each_project_defined_status) && (each_dict_bs_cash.MTD)){\n        \t\t\t            found_bs_cash_mtd = true;\n        \t\t\t            count_found_bs_cash_mtd += each_dict_bs_cash.total_ro;\n        \t\t\t            count_found_bs_cash_mtd_avg += each_dict_bs_cash.average;\n        \t\t\t            total_time_take_bs_cash_mtd += each_dict_bs_cash.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `MTD`, \\\"\"+selected_branch+\"\\\", \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_cash.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_cash.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_cash_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `MTD`, \\\"\"+selected_branch+\"\\\", \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_bs_cash of res.message.body_shop_cash_category) {\n        \t\t\t        if((each_dict_bs_cash.project_status == each_project_defined_status) && (each_dict_bs_cash.YTD)){\n        \t\t\t            found_bs_cash_ytd = true;\n        \t\t\t            count_found_bs_cash_ytd += each_dict_bs_cash.total_ro;\n        \t\t\t            count_found_bs_cash_ytd_avg += each_dict_bs_cash.average;\n        \t\t\t            total_time_take_bs_cash_ytd += each_dict_bs_cash.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `YTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_cash.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_cash.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_cash_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Customer`, null, `YTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    for(let each_dict_bs_insurance of res.message.body_shop_insurance_category) {\n        \t\t\t        if((each_dict_bs_insurance.project_status == each_project_defined_status) && (each_dict_bs_insurance.MTD)){\n        \t\t\t            found_bs_insurance_mtd = true;\n        \t\t\t            count_found_bs_insurance_mtd += each_dict_bs_insurance.total_ro;\n        \t\t\t            count_found_bs_insurance_avg_mtd += each_dict_bs_insurance.average;\n        \t\t\t            total_time_take_bs_insurance_mtd += each_dict_bs_insurance.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null, `MTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_insurance.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_insurance.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_insurance_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null,  `MTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_bs_insurance of res.message.body_shop_insurance_category) {\n        \t\t\t        if((each_dict_bs_insurance.project_status == each_project_defined_status) && (each_dict_bs_insurance.YTD)){\n        \t\t\t            found_bs_insurance_ytd = true;\n        \t\t\t            count_found_bs_insurance_ytd += each_dict_bs_insurance.total_ro;\n        \t\t\t            count_found_bs_insurance_avg_ytd += each_dict_bs_insurance.average;\n        \t\t\t            total_time_take_bs_insurance_ytd += each_dict_bs_insurance.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null, `YTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_bs_insurance.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_bs_insurance.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_bs_insurance_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", `Body Shop`,`Insurance`, null, `YTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    for(let each_dict_brac of res.message.brac_category) {\n        \t\t\t        if((each_dict_brac.project_status == each_project_defined_status) && (each_dict_brac.MTD)){\n        \t\t\t            found_brac_mtd = true;\n        \t\t\t            count_found_brac_mtd += each_dict_brac.total_ro;\n        \t\t\t            count_found_brac_avg_mtd += each_dict_brac.average;\n        \t\t\t            total_time_take_brac_mtd += each_dict_brac.total_time_take;\n        \t\t\t            tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `MTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_brac.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_brac_mtd) {\n        \t\t\t        tr_message += \"<td onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `MTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    for(let each_dict_brac of res.message.brac_category) {\n        \t\t\t        if((each_dict_brac.project_status == each_project_defined_status) && (each_dict_brac.YTD)){\n        \t\t\t            found_brac_ytd = true;\n        \t\t\t            count_found_brac_ytd += each_dict_brac.total_ro;\n        \t\t\t            count_found_brac_avg_ytd += each_dict_brac.average;\n        \t\t\t            total_time_take_brac_ytd += each_dict_brac.total_time_take;\n        \t\t\t            tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `YTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>\"+each_dict_brac.total_ro+\"</td>\"+\"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac.average+\"</td>\"\n        \t\t\t        }\n        \t\t\t    }\n        \t\t\t    \n        \t\t\t    if(!found_brac_ytd) {\n        \t\t\t        tr_message += \"<td style='background-color: #f8f8f8;text-decoration: underline;text-align: center;border:1px solid #d1d8dd;cursor: pointer;' onclick='drill_down_ytd(\\\"\"+each_project_defined_status+\"\\\", null, null, `Brac`, `YTD`, \\\"\"+selected_branch+\"\\\",  \\\"\"+project_task_type+\"\\\")' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;text-decoration: underline;cursor: pointer;'>0</td><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t\t    }\n        \t\t\t    tr_message += \"</tr>\"\n        \t\t\t    \n    \t\t\t    }\n    \t\t\t    \n    \t\t\t    tr_message += \"<tr style='background-color:#f8f8f8;'><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>Total</b></td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_mechanical_mtd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_mechanical_mtd>0 ?Math.ceil(total_time_take_mechanical_mtd / count_found_mechanical_mtd):0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_mechanical_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_mechanical_ytd>0?Math.ceil(total_time_take_mechanical_ytd / count_found_mechanical_ytd) : 0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_cash_mtd+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_cash_mtd > 0 ? Math.ceil(total_time_take_bs_cash_mtd / count_found_bs_cash_mtd) : 0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_cash_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_cash_ytd>0?Math.ceil(total_time_take_bs_cash_ytd / count_found_bs_cash_ytd) : 0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_insurance_mtd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_insurance_mtd?Math.ceil(total_time_take_bs_insurance_mtd / count_found_bs_insurance_mtd):0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_bs_insurance_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_bs_insurance_ytd>0?Math.ceil(total_time_take_bs_insurance_ytd / count_found_bs_insurance_ytd):0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_brac_mtd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_brac_mtd>0?Math.ceil(total_time_take_brac_mtd / count_found_brac_mtd):0)+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+count_found_brac_ytd+\"</td>\";\n    \t\t\t    tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(count_found_brac_ytd>0?Math.ceil(total_time_take_brac_ytd / count_found_brac_ytd):0)+\"</td>\";\n    \t\t\t    \n    \t\t\t    \n    \t\t\t    tbody_ele.innerHTML = tr_message;\n    \t\t\t    some_class_element.style.display = 'block';\n                }\n        }\n    });\n}\n\nfetch_brac_data();\n\n// 7. Add listener to Apply Filter button\nlet apply_btn = root_element.querySelector(\".apply-filter-btn\");\n\napply_btn.addEventListener(\"click\", () => {\n  fetch_brac_data(location_control.get_value());\n});\n\nlet download_button_icon_id = root_element.querySelector(\"#download_button_icon_id\");\n\ndownload_button_icon_id.addEventListener(\"click\", () => {\n  downloadTableAsExcel('#vehicle_movement_table');\n});\n\nfunction downloadTableAsExcel(table_id){\n    \n    let table = root_element.querySelector(table_id);\n    if (!table) {\n        console.error(\"Table with ID '\" + tableId + \"' not found!\");\n        return;\n    }\n\n    let tableHTML = table.outerHTML;\n    \n    window.open_url_post(\"/api/method/pitstop_email_digest.utils.vehicle_movement.vehicle_movement.download_excel_sheet\", {\n        cmd: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.download_excel_sheet\",\n        html_table: tableHTML\n    }, true);\n    \n}\n",
  "style": null
 },
 {
  "creation": "2025-07-29 09:54:12.641838",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Main bordered container -->\n<div style=\"border: 1px solid #d1d8dd; padding: 16px; border-radius: 6px; background-color: #fff;\">\n\n  <!-- Filter Row -->\n<div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px;\">\n\n  <!-- Posting Date Field -->\n  <div class=\"form-group\" style=\"margin: 0;\">\n    <div class=\"control-input-wrapper\" style=\"width: auto;\">\n      <div class=\"control-input\" style=\"width: auto;\">\n        <div class=\"posting-date-field\"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Apply Filter Button -->\n  <div style=\"margin-bottom: -1%;\">\n    <button type=\"button\" class=\"btn btn-primary apply-filter-btn\">Apply Filter</button>\n  </div>\n\n</div>\n\n  <!-- Table -->\n  <table id=\"vehicle_movement_table_brac_a_day\" style=\"width:100%; border-collapse:collapse;\">\n    <thead id=\"vehicle_movement_table_header\">\n      <tr>\n        <td rowspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Status</td>\n        <td colspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Number Of Cars</td>\n      </tr>\n      <tr>\n        <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Mechanical</td>\n        <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Bodyshop</td>\n        <td style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Total</td>\n      </tr>\n    </thead>\n    <tbody id=\"vehicle_movement_tbody_division_brac_a_day\">\n    </tbody>\n  </table>\n\n</div>\n",
  "modified": "2025-09-03 11:12:39.094019",
  "name": "Vehicle Movement a Day BRAC",
  "private": 0,
  "roles": [],
  "script": "// 1. Get wrapper for date field\nlet posting_date_wrapper = root_element.querySelector(\".posting-date-field\");\n\n// 2. Get today's date in YYYY-MM-DD\nlet today = frappe.datetime.get_today();\n\n// 3. Create the native Frappe date field\nlet posting_date_control = frappe.ui.form.make_control({\n  df: {\n    fieldtype: \"Date\",\n    fieldname: \"posting_date\",\n    label: \"Job Date\",\n    reqd: 1,\n    default: today\n  },\n  parent: posting_date_wrapper,\n  render_input: true\n});\n\n// 4. Render the field with today's value\nposting_date_control.refresh();\nposting_date_control.set_value(today);\n\n// 5. Define your data-fetching function\nfunction fetchVehicleMovementData(selected_date) {\n  const division_dict = [\n    {\n      \"workshop_division\": \"Body Shop\",\n      \"bill_to_customer_check\": null,\n      \"category\": \"BRAC BODYSHOP\"\n    },\n    {\n      \"workshop_division\": \"Mechanical\",\n      \"bill_to_customer_check\": null,\n      \"category\": \"BRAC MECHANICAL\"\n    },\n  ];\n\n  frappe.call({\n    method: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement.fetch_ro_project_status_based_workshop_division_for_vehicle\",\n    args: {\n      division_dict: division_dict,\n      timespan: \"Custom Date\",\n      selected_date: selected_date,\n      workspace:\"Brac\"\n    },\n    freeze: 1,\n    freeze_message: __(\"Fetching..\"),\n    callback: (res) => {\n      \n      \n      var custom_order = [\n        \t\t\"To Estimate\",\n        \t\t\"Awaiting Approval\",\n        \t\t\"Awaiting Claim No\",\n        \t\t\"To Assign\",\n        \t\t\"Awaiting Parts\",\n        \t\t\"Awaiting Parts Estimate\",\n        \t\t\"Parts Arrived\",\n        \t\t\"Tasks Completed\",\n        \t\t\"Awaiting LPO\",\n        \t\t\"Awaiting Gate Pass\",\n        \t\t\"Ready for Collection\",\n        \t\t\"Not Invoiced\",\n        \t\t\"Total Loss\",\n        \t\t\"Completed\"\n        \t];\n      for(let each_key_bbs of res.message.brac_bodyshop) {\n        if(each_key_bbs.current_task_type){\n            if(!custom_order.includes(each_key_bbs.project_status)) {\n                custom_order.splice(4,0,each_key_bbs.project_status);\n            }\n        }\n      }\n      \n      for(let each_key_bmech of res.message.brac_mechanical) {\n          if(each_key_bmech.current_task_type){\n            if(!custom_order.includes(each_key_bmech.project_status)) {\n                custom_order.splice(5,0,each_key_bmech.project_status);\n            }\n        }  \n      }\n      let tbody_ele = root_element.querySelector('#vehicle_movement_tbody_division_brac_a_day');\n      tbody_ele.innerHTML = \"\";\n      let tr_message = \"\";\n      let mechanical_total_count = 0;\n      let bodyshop_total_count = 0;\n      let brac_total_count = 0;\n      if (res.message) {\n          for(let each_project_defined_status of custom_order) {\n            let status_count_mechanical = 0;\n            let status_count_bodyshop = 0;\n            let found_mechanical = false;\n            let found_bodyshop = false;\n            let status_data_tr = \"\";\n            status_data_tr = \"<tr><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_project_defined_status+\"</td>\";\n            for(let each_dict_brac_mechanical of res.message.brac_mechanical) {\n\t\t        if(each_dict_brac_mechanical.project_status == each_project_defined_status){\n\t\t            found_mechanical = true;\n\t\t            status_count_mechanical += each_dict_brac_mechanical.total_ro;\n\t\t            status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac_mechanical.total_ro+\"</td>\";\n\t\t        }\n\t\t    }\n\t\t    if(!found_mechanical){\n\t\t           status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n\t\t    }\n\t\t    for(let each_dict_brac_bodyshop of res.message.brac_bodyshop) {\n\t\t        if(each_dict_brac_bodyshop.project_status == each_project_defined_status){\n\t\t            found_bodyshop = true;\n\t\t            status_count_bodyshop += each_dict_brac_bodyshop.total_ro;\n\t\t            status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_dict_brac_bodyshop.total_ro+\"</td>\";\n\t\t        }\n\t\t    }\n\t\t    \n\t\t    if(!found_bodyshop){\n\t\t           status_data_tr += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n\t\t    }\n\t\t    \n\t\t    if(found_mechanical || found_bodyshop) {\n\t\t        tr_message += status_data_tr;\n\t\t        mechanical_total_count += status_count_mechanical;\n\t\t        bodyshop_total_count += status_count_bodyshop;\n\t\t        let sum_bodyshop_mechanical = status_count_mechanical+status_count_bodyshop;\n\t\t        tr_message += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+sum_bodyshop_mechanical+\"</td></tr>\";\n\t\t    }\n          }\n        if(!tr_message) {\n            tr_message += `\n                <tr>\n                    <td colspan=\"4\" style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>No Data</td>\n                </tr>\n            `;\n        }\n        else {\n            tr_message += `<tr style='background: #f8f8f8;'>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>Total</b></td>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>${mechanical_total_count}</b></td>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>${bodyshop_total_count}</b></td>\n                  <td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>${mechanical_total_count+bodyshop_total_count}</b></td>\n                </tr>`;\n        }\n        tbody_ele.innerHTML = tr_message;\n      }\n    }\n  });\n}\n\n// 6. Trigger fetch immediately on load with today\nfetchVehicleMovementData(today);\n\n// 7. Add listener to Apply Filter button\nlet apply_btn = root_element.querySelector(\".apply-filter-btn\");\n\napply_btn.addEventListener(\"click\", () => {\n  let selected_date = posting_date_control.get_value();\n\n  if (!selected_date) {\n    frappe.msgprint(\"Please select a date.\");\n    return;\n  }\n\n  fetchVehicleMovementData(selected_date);\n});\n",
  "style": null
 },
 {
  "creation": "2025-10-08 10:20:24.211794",
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<style>\n    .td_class {\n        border:1px solid #d1d8dd,\n        padding:6px 8px,\n    }\n    .custom-form-group {\n    \tmargin-bottom: 0.6rem;\n    \n    \t&.frappe-control:last-child {\n    \t\tmargin-bottom: 0;\n    \t}\n    \t&:last-child.frappe-control[data-fieldtype=\"Table\"] {\n    \t\tmargin-bottom: 0;\n    \t}\n    \t&.frappe-control[data-fieldtype=\"Check\"] {\n    \t\tmargin-bottom: 0;\n    \t}\n    }\n</style>\n\n\n<!-- Filter Row -->\n<div id=\"date_filter_invoice_wip_map\" \n     style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px; position: relative;\">\n\n  <div class=\"form-group\" style=\"margin: 0;\">\n    <div class=\"control-input-wrapper\" style=\"width: auto;\">\n      <div class=\"control-input\" style=\"width: auto;\">\n        <div id=\"from_date_filter\" class=\"location-field\"></div>\n      </div>\n    </div>\n  </div>\n  \n  <div class=\"form-group\" style=\"margin: 0;\">\n    <div class=\"control-input-wrapper\" style=\"width: auto;\">\n      <div class=\"control-input\" style=\"width: auto;\">\n        <div id=\"to_date_filter\" class=\"location-field\"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Apply Filter Button -->\n  <div style=\"margin-bottom: -1%;\">\n    <button id=\"apply_date_filter_button\" type=\"button\" class=\"btn btn-primary apply-filter-btn\">Apply Filter</button>\n  </div>\n\n</div>\n\n<div>\n    <table id=\"wip_invoice_map_table_autoworks\" style=\"width:100%; border-collapse:collapse; margin:30px 0;\">\n        <thead id=\"wip_invoice_map_table_autoworks_header\">\n            <tr>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Branch</td>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Target</td>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Actual</td>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Achieved(%)</td>\n                <td colspan=\"17\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Work In Progress</td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">BRAC</td>\n                <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Tesla</td>\n                <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Other</td>\n            </tr>\n            <tr>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">ROs</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Revenue</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">ROs</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Revenue</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">ROs</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Revenue</td>\n            </tr>\n        </thead>\n        <tbody id=\"autoworks_invoice_wip_map\">\n            <tr>\n                <td colspan=\"10\" style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\n                    No Data\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <table id=\"wip_invoice_map_table_autocare\" style=\"width:100%; border-collapse:collapse; margin:30px 0;\">\n        <thead id=\"wip_invoice_map_table_autocare_header\">\n            <tr>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Branch</td>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Target</td>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Actual</td>\n                <td rowspan=\"3\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Achieved(%)</td>\n                <td colspan=\"17\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Work In Progress</td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">BMW</td>\n                <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Geely</td>\n                <td colspan=\"2\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Other</td>\n            </tr>\n            <tr>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">ROs</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Revenue</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">ROs</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Revenue</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">ROs</td>\n                <td colspan=\"1\" style=\"border:1px solid #d1d8dd;padding:6px 8px;font-weight:bold;background:#f8f8f8;text-align:center;\">Revenue</td>\n            </tr>\n        </thead>\n        <tbody id=\"autocare_invoice_wip_map\">\n            <tr>\n                <td colspan=\"10\" style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\n                    No Data\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <small>Below job statuses (data) have been used to prepare the Work in Progress (WIP) section.</small>\n    <ol>\n      <li>Awaiting LPO</li>\n      <li>Not Invoiced</li>\n      <li>Ready for Collection</li>\n      <li>Tasks Completed</li>\n    </ol>\n</div>",
  "modified": "2025-10-09 16:19:49.542933",
  "name": "Invoice WIP MAP",
  "private": 0,
  "roles": [],
  "script": "let from_date_wrapper = root_element.querySelector(\"#from_date_filter\");\nlet to_date_wrapper = root_element.querySelector(\"#to_date_filter\");\n\nlet from_date_wrapper_control = frappe.ui.form.make_control({\n    df: {\n        fieldtype: \"Date\",\n        fieldname: \"from_date\",\n        label: \"From Date\",\n        reqd: 0\n    },\n    parent: from_date_wrapper,\n    render_input: true\n});\n\nlet to_date_wrapper_control = frappe.ui.form.make_control({\n    df: {\n        fieldtype: \"Date\",\n        fieldname: \"to_date\",\n        label: \"To Date\",\n        reqd: 0\n    },\n    parent: to_date_wrapper,\n    render_input: true\n});\n\n// ensure input is rendered\nfrom_date_wrapper_control.refresh();\nto_date_wrapper_control.refresh();\n\n// set default\nfrom_date_wrapper_control.set_value(frappe.datetime.month_start());\nto_date_wrapper_control.set_value(frappe.datetime.get_today());\n\nlet tbody_ele_autoworks_invoice_wip_map = root_element.querySelector('#autoworks_invoice_wip_map');\nlet tbody_ele_autocare_invoice_wip_map = root_element.querySelector('#autocare_invoice_wip_map');\n\nfunction fetch_invoice_wip_data(from_date, to_date) {\n    \n    // tbody_ele_autoworks_invoice_wip_map.innerHTML = \"\";\n    // tbody_ele_autocare_invoice_wip_map.innerHTML = \"\";\n    \n    frappe.call({\n    \t\tmethod: \"pitstop_email_digest.utils.vehicle_movement.vehicle_movement_invoice_wip.fetch_revenue_branchwise_based_on_costcenter\",\n    \t\targs: {\n    \t\t  from_date: from_date,\n    \t\t  to_date: to_date\n    \t\t},\n    \t\tfreeze: 1,\n    \t\tfreeze_message: __(\"Fetching..\"),\n    \t\tcallback: (res) => {\n    \t\t    if(res.message && res.message.cost_center_branch_list) {\n    \t\t        if(res.message.cost_center_branch_list.length>0) {\n    \t\t            let autoworks_branch_list = [];\n    \t\t            \n    \t\t            for(let each_cost_center_branch_list of res.message.cost_center_branch_list) {\n    \t\t                if(each_cost_center_branch_list.cost_center == \"AutoWorks - PASLLC\") {\n    \t\t                    for(let row_each_cost_center_branch_list_branch_revenue_details of each_cost_center_branch_list.branch_revenue_details) {\n    \t\t                        autoworks_branch_list.push(row_each_cost_center_branch_list_branch_revenue_details.Branch);\n    \t\t                    }\n    \t\t                }\n    \t\t            }\n    \t\t            \n    \t\t            for(let each_customer_group_cost_center_revenue_list of res.message.customer_group_cost_center_revenue_list) {\n    \t\t                if(each_customer_group_cost_center_revenue_list.cost_center == \"AutoWorks - PASLLC\") {\n    \t\t                    for(let row_each_customer_group_cost_center_revenue_list of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n    \t\t                        autoworks_branch_list.push(row_each_customer_group_cost_center_revenue_list.branch);\n    \t\t                    }\n    \t\t                }\n    \t\t            }\n    \t\t            \n    \t\t            autoworks_branch_list = [...new Set(autoworks_branch_list)];\n    \t\t            \n    \t\t            //first we process autoworks\n    \t\t            let tr_message_autoworks = \"\"\n    \t\t            for(let each_autoworks_branch_list of autoworks_branch_list) {\n    \t\t                tr_message_autoworks += \"<tr><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_autoworks_branch_list+\"</td>\";\n    \t\t                for(let each_cost_center_branch_list of res.message.cost_center_branch_list) {\n        \t\t                if(each_cost_center_branch_list.cost_center == \"AutoWorks - PASLLC\") {\n        \t\t                    let tdAdded_branch_autoworks = false;\n        \t\t                    for(let row_each_cost_center_branch_list_branch_revenue_details of each_cost_center_branch_list.branch_revenue_details) {\n        \t\t                        if(row_each_cost_center_branch_list_branch_revenue_details.Branch == each_autoworks_branch_list) {\n        \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+Math.round(row_each_cost_center_branch_list_branch_revenue_details.Target).toLocaleString('en-AE')+\"</td>\"\n        \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+Math.round(row_each_cost_center_branch_list_branch_revenue_details.Revenue).toLocaleString('en-AE')+\"</td>\"\n        \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_cost_center_branch_list_branch_revenue_details.Target>0)?\n        \t\t                            ((row_each_cost_center_branch_list_branch_revenue_details.Revenue/\n        \t\t                            row_each_cost_center_branch_list_branch_revenue_details.Target)*100.0):0).toFixed(2)+\"</td>\";\n        \t\t                            tdAdded_branch_autoworks = true;\n        \t\t                            break;\n        \t\t                        }\n        \t\t                    }\n        \t\t                    if(!tdAdded_branch_autoworks) {\n        \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t                        }\n        \t\t                }\n        \t\t            }\n        \t\t            \n        \t\t            let autoworks_customer_group = [\"Budget Mobility\"];\n        \t\t            let autoworks_vehicle_group = [\"TESLA\"];\n        \t\t            let autoworks_others_group = [\"Others\"];\n        \t\t            \n        \t\t            for(let each_customer_group_cost_center_revenue_list of res.message.customer_group_cost_center_revenue_list) {\n        \t\t                if(each_customer_group_cost_center_revenue_list.cost_center == \"AutoWorks - PASLLC\") {\n        \t\t                    for(let each_autoworks_customer_group of autoworks_customer_group) {\n        \t\t                        let tdAdded_customer_group_autoworks = false;\n            \t\t                    for(let row_each_customer_group_cost_center_details of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n            \t\t                        if((row_each_customer_group_cost_center_details.branch == each_autoworks_branch_list) && \n            \t\t                        (row_each_customer_group_cost_center_details.customer_group == each_autoworks_customer_group)) {\n            \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_customer_group_cost_center_details.ro_count)?row_each_customer_group_cost_center_details.ro_count:0)+\"</td>\"\n            \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+(row_each_customer_group_cost_center_details.revenue?Math.round(row_each_customer_group_cost_center_details.revenue).toLocaleString('en-AE'):0)+\"</td>\"\n            \t\t                            tdAdded_customer_group_autoworks = true; // mark that we added a value\n                                                break;\n            \t\t                        }\n            \t\t                    }\n            \t\t                    // If no match found, add zero\n                                        if (!tdAdded_customer_group_autoworks) {\n                                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                        }\n        \t\t                    }\n        \t\t                    \n        \t\t                    for(let each_autoworks_vehicle_group of autoworks_vehicle_group) {\n        \t\t                        let tdAdded_vehicle_group_autoworks = false;\n            \t\t                    for(let row_each_customer_group_cost_center_details of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n            \t\t                        if((row_each_customer_group_cost_center_details.branch == each_autoworks_branch_list) && \n            \t\t                        (row_each_customer_group_cost_center_details.vehicle_group == each_autoworks_vehicle_group)) {\n            \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_customer_group_cost_center_details.ro_count)?row_each_customer_group_cost_center_details.ro_count:0)+\"</td>\"\n            \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+(row_each_customer_group_cost_center_details.revenue?Math.round(row_each_customer_group_cost_center_details.revenue).toLocaleString('en-AE'):0)+\"</td>\"\n            \t\t                            tdAdded_vehicle_group_autoworks = true; // mark that we added a value\n                                                break;\n            \t\t                        }\n            \t\t                    }\n            \t\t                    // If no match found, add zero\n                                        if (!tdAdded_vehicle_group_autoworks) {\n                                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                        }\n        \t\t                    }\n        \t\t                    \n        \t\t                    for(let each_autoworks_others_group of autoworks_others_group) {\n        \t\t                        let tdAdded_others_group_autoworks = false;\n            \t\t                    for(let row_each_customer_group_cost_center_details of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n            \t\t                        if((row_each_customer_group_cost_center_details.branch == each_autoworks_branch_list) && \n            \t\t                        (row_each_customer_group_cost_center_details.customer_group == each_autoworks_others_group)) {\n            \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_customer_group_cost_center_details.ro_count)?row_each_customer_group_cost_center_details.ro_count:0)+\"</td>\"\n            \t\t                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+(row_each_customer_group_cost_center_details.revenue?Math.round(row_each_customer_group_cost_center_details.revenue).toLocaleString('en-AE'):0)+\"</td>\"\n            \t\t                            tdAdded_others_group_autoworks = true; // mark that we added a value\n                                                break;\n            \t\t                        }\n            \t\t                    }\n            \t\t                    // If no match found, add zero\n                                        if (!tdAdded_others_group_autoworks) {\n                                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                        }\n        \t\t                    }\n        \t\t                }\n        \t\t            }\n        \t\t            tr_message_autoworks += \"</tr>\"\n    \t\t            }\n    \t\t            let total_row_obj = totalrow_calculation(\"AutoWorks - PASLLC\",res.message);\n    \t\t            tr_message_autoworks += \"<tr style='background-color:#f8f8f8;'><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>Auto Works (Total)</b></td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj.target_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj.revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj.target_total?((total_row_obj.revenue_total/total_row_obj.target_total)*100):0.0).toFixed(2)+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj.brac_ro_count_total)+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj.brac_revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj.tesla_ro_count_total)+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj.tesla_revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj.others_ro_count_total)+\"</td>\";\n    \t\t            tr_message_autoworks += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj.others_revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tbody_ele_autoworks_invoice_wip_map.innerHTML = tr_message_autoworks;\n    \t\t            \n    \t\t            //start auto care from here\n    \t\t            let autocare_branch_list = [];\n    \t\t            \n    \t\t            for(let each_cost_center_branch_list of res.message.cost_center_branch_list) {\n    \t\t                if(each_cost_center_branch_list.cost_center == \"AutoCare - PASLLC\") {\n    \t\t                    for(let row_each_cost_center_branch_list_branch_revenue_details of each_cost_center_branch_list.branch_revenue_details) {\n    \t\t                        autocare_branch_list.push(row_each_cost_center_branch_list_branch_revenue_details.Branch);\n    \t\t                    }\n    \t\t                }\n    \t\t            }\n    \t\t            \n    \t\t            for(let each_customer_group_cost_center_revenue_list of res.message.customer_group_cost_center_revenue_list) {\n    \t\t                if(each_customer_group_cost_center_revenue_list.cost_center == \"AutoCare - PASLLC\") {\n    \t\t                    for(let row_each_customer_group_cost_center_revenue_list of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n    \t\t                        autocare_branch_list.push(row_each_customer_group_cost_center_revenue_list.branch);\n    \t\t                    }\n    \t\t                }\n    \t\t            }\n    \t\t            autocare_branch_list = [...new Set(autocare_branch_list)];\n    \t\t            \n    \t\t            //second we process autocare\n    \t\t            let tr_message_autocare = \"\"\n    \t\t            for(let each_autocare_branch_list of autocare_branch_list) {\n    \t\t                tr_message_autocare += \"<tr><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+each_autocare_branch_list+\"</td>\";\n    \t\t                for(let each_cost_center_branch_list of res.message.cost_center_branch_list) {\n        \t\t                if(each_cost_center_branch_list.cost_center == \"AutoCare - PASLLC\") {\n        \t\t                    let tdAdded_branch_autocare = false;\n        \t\t                    for(let row_each_cost_center_branch_list_branch_revenue_details of each_cost_center_branch_list.branch_revenue_details) {\n        \t\t                        \n        \t\t                        if(row_each_cost_center_branch_list_branch_revenue_details.Branch == each_autocare_branch_list) {\n        \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+Math.round(row_each_cost_center_branch_list_branch_revenue_details.Target).toLocaleString('en-AE')+\"</td>\"\n        \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+Math.round(row_each_cost_center_branch_list_branch_revenue_details.Revenue).toLocaleString('en-AE')+\"</td>\"\n        \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_cost_center_branch_list_branch_revenue_details.Target>0)?\n        \t\t                            ((row_each_cost_center_branch_list_branch_revenue_details.Revenue/\n        \t\t                            row_each_cost_center_branch_list_branch_revenue_details.Target)*100.0):0).toFixed(2)+\"</td>\"\n        \t\t                            tdAdded_branch_autocare = true;\n        \t\t                            break;\n        \t\t                        }\n        \t\t                    }\n        \t\t                    if(!tdAdded_branch_autocare) {\n        \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\"\n        \t\t                        }\n        \t\t                }\n        \t\t            }\n        \t\t            let autocare_customer_group = [];//hence not need to process\n        \t\t            let autocare_vehicle_group = [\"BMW\", \"GEELY\"];\n        \t\t            let autocare_others_group = [\"Others\"];\n        \t\t            \n        \t\t            for(let each_customer_group_cost_center_revenue_list of res.message.customer_group_cost_center_revenue_list) {\n        \t\t                if(each_customer_group_cost_center_revenue_list.cost_center == \"AutoCare - PASLLC\") {\n        \t\t                    \n        \t\t                    for(let each_autocare_vehicle_group of autocare_vehicle_group) {\n        \t\t                        let tdAdded_vehicle_group_autocare = false;\n            \t\t                    for(let row_each_customer_group_cost_center_details of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n            \t\t                        if((row_each_customer_group_cost_center_details.branch == each_autocare_branch_list) && \n            \t\t                            (row_each_customer_group_cost_center_details.vehicle_group == each_autocare_vehicle_group)) {\n            \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_customer_group_cost_center_details.ro_count)?row_each_customer_group_cost_center_details.ro_count:0)+\"</td>\"\n            \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+(row_each_customer_group_cost_center_details.revenue?Math.round(row_each_customer_group_cost_center_details.revenue).toLocaleString('en-AE'):0)+\"</td>\"\n            \t\t                            tdAdded_vehicle_group_autocare = true; // mark that we added a value\n                                                break;\n            \t\t                        }\n            \t\t                    }\n            \t\t                    // If no match found, add zero\n                                        if (!tdAdded_vehicle_group_autocare) {\n                                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                        }\n        \t\t                    }\n        \t\t                    \n        \t\t                    for(let each_autocare_others_group of autocare_others_group) {\n        \t\t                        let tdAdded_others_group_autocare = false;\n            \t\t                    for(let row_each_customer_group_cost_center_details of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n            \t\t                        if((row_each_customer_group_cost_center_details.branch == each_autocare_branch_list) && \n            \t\t                        (row_each_customer_group_cost_center_details.customer_group == each_autocare_others_group)) {\n            \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+((row_each_customer_group_cost_center_details.ro_count)?row_each_customer_group_cost_center_details.ro_count:0)+\"</td>\"\n            \t\t                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\"+(row_each_customer_group_cost_center_details.revenue?Math.round(row_each_customer_group_cost_center_details.revenue).toLocaleString('en-AE'):0)+\"</td>\"\n            \t\t                            tdAdded_others_group_autocare = true; // mark that we added a value\n                                                break;\n            \t\t                        }\n            \t\t                    }\n            \t\t                    // If no match found, add zero\n                                        if (!tdAdded_others_group_autocare) {\n                                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>0</td>\";\n                                        }\n        \t\t                    }\n        \t\t                }\n        \t\t            }\n        \t\t            tr_message_autocare += \"</tr>\"\n    \t\t            }\n    \t\t            let total_row_obj_autocare = totalrow_calculation(\"AutoCare - PASLLC\",res.message);\n    \t\t            \n    \t\t          //  tbody_ele_autocare_invoice_wip_map.innerHTML = tr_message_autocare;\n    \t\t            tr_message_autocare += \"<tr style='background-color:#f8f8f8;'><td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'><b>Auto Care (Total)</b></td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj_autocare.target_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj_autocare.revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj_autocare.target_total?((total_row_obj_autocare.revenue_total/total_row_obj_autocare.target_total)*100):0).toFixed(2)+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj_autocare.bmw_ro_count_total)+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj_autocare.bmw_revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj_autocare.geely_ro_count_total)+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj_autocare.geely_revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+(total_row_obj_autocare.others_ro_count_total)+\"</td>\";\n    \t\t            tr_message_autocare += \"<td style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;font-weight:bold;'>\"+Math.round(total_row_obj_autocare.others_revenue_total).toLocaleString('en-AE')+\"</td>\";\n    \t\t            tbody_ele_autocare_invoice_wip_map.innerHTML = tr_message_autocare;\n    \t\t        }\n    \t\t    }\n    \t\t}\n        }\n    )\n}\n\nfunction totalrow_calculation(cost_center, data_array) {\n    let total_row_obj = {\n        \"target_total\":0, \"revenue_total\":0, \n        \"brac_ro_count_total\":0, \"brac_revenue_total\":0,\n        \"tesla_ro_count_total\":0, \"tesla_revenue_total\":0,\n        \"bmw_ro_count_total\":0, \"bmw_revenue_total\":0,\n        \"geely_ro_count_total\":0, \"geely_revenue_total\":0,\n        \"others_ro_count_total\":0, \"others_revenue_total\":0,\n    };\n    if(data_array) {\n       for(let each_data_array of data_array.cost_center_branch_list) {\n           if(each_data_array.cost_center == cost_center) {\n               for(let each_branch_revenue_details of each_data_array.branch_revenue_details) {\n                   total_row_obj.target_total += each_branch_revenue_details.Target;\n                   total_row_obj.revenue_total += each_branch_revenue_details.Revenue;\n               }\n           }\n       }\n       \n       for(let each_customer_group_cost_center_revenue_list of data_array.customer_group_cost_center_revenue_list) {\n           if(each_customer_group_cost_center_revenue_list.cost_center == cost_center) {\n               for(let each_customer_group_cost_center_details of each_customer_group_cost_center_revenue_list.customer_group_cost_center_details) {\n                   if(each_customer_group_cost_center_details.customer_group == \"Budget Mobility\") {\n                        total_row_obj.brac_ro_count_total += each_customer_group_cost_center_details.ro_count;\n                        total_row_obj.brac_revenue_total += each_customer_group_cost_center_details.revenue;   \n                    }\n                    if(each_customer_group_cost_center_details.vehicle_group == \"TESLA\") {\n                        total_row_obj.tesla_ro_count_total += each_customer_group_cost_center_details.ro_count;\n                        total_row_obj.tesla_revenue_total += each_customer_group_cost_center_details.revenue;   \n                    }\n                    if(each_customer_group_cost_center_details.vehicle_group == \"BMW\") {\n                        total_row_obj.bmw_ro_count_total += each_customer_group_cost_center_details.ro_count;\n                        total_row_obj.bmw_revenue_total += each_customer_group_cost_center_details.revenue;   \n                    }\n                    if(each_customer_group_cost_center_details.vehicle_group == \"GEELY\") {\n                        total_row_obj.geely_ro_count_total += each_customer_group_cost_center_details.ro_count;\n                        total_row_obj.geely_revenue_total += each_customer_group_cost_center_details.revenue;   \n                    }\n                    if(each_customer_group_cost_center_details.customer_group == \"Others\") {\n                        total_row_obj.others_ro_count_total += each_customer_group_cost_center_details.ro_count;\n                        total_row_obj.others_revenue_total += each_customer_group_cost_center_details.revenue;   \n                    }\n                }\n           }\n       }\n       \n       return total_row_obj\n    }\n}\n\n// 7. Add listener to Apply Filter button\nlet apply_date_filter_btn = root_element.querySelector(\"#apply_date_filter_button\");\n\nfunction set_no_data_method() {\n    tbody_ele_autoworks_invoice_wip_map.innerHTML = `<tr>\n                <td colspan='10' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\n                    No Data\n                </td>\n            </tr>`\n    tbody_ele_autocare_invoice_wip_map.innerHTML = `<tr>\n            <td colspan='10' style='border:1px solid #d1d8dd;padding:6px 8px;text-align:center;'>\n                No Data\n            </td>\n        </tr>`\n}\n\napply_date_filter_btn.addEventListener(\"click\", () => {\n    if(!from_date_wrapper_control.get_value()) {\n        set_no_data_method();\n        frappe.throw(\"From date is mandatory\");\n        \n    }\n    if(!to_date_wrapper_control.get_value()) {\n        set_no_data_method();\n        frappe.throw(\"To date is mandatory\");\n    }\n    \n    if(to_date_wrapper_control.get_value()<from_date_wrapper_control.get_value()) {\n        set_no_data_method();\n        frappe.throw(\"From Date should before the To date\");\n    }\n    \n    fetch_invoice_wip_data(from_date_wrapper_control.get_value(), to_date_wrapper_control.get_value());\n    \n});\nfetch_invoice_wip_data(frappe.datetime.month_start(), frappe.datetime.get_today());\n\n",
  "style": null
 }
]